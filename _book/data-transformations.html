<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Stage 3 Data transformations | R Notebook</title>
  <meta name="description" content="Stage 3 Data transformations | R Notebook" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Stage 3 Data transformations | R Notebook" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stage 3 Data transformations | R Notebook" />
  
  
  

<meta name="author" content="Pedro Miguel de Sousa Magalhães" />


<meta name="date" content="2022-01-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-aquisition-and-understanding.html"/>
<link rel="next" href="modeling.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro Data Science: Long Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="business-understanding.html"><a href="business-understanding.html"><i class="fa fa-check"></i><b>1</b> Business Understanding</a>
<ul>
<li class="chapter" data-level="1.1" data-path="business-understanding.html"><a href="business-understanding.html#business-objectives"><i class="fa fa-check"></i><b>1.1</b> Business objectives</a></li>
<li class="chapter" data-level="1.2" data-path="business-understanding.html"><a href="business-understanding.html#assess-situation"><i class="fa fa-check"></i><b>1.2</b> Assess Situation</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="business-understanding.html"><a href="business-understanding.html#hardware-and-environment-special-needs"><i class="fa fa-check"></i><b>1.2.1</b> Hardware and environment special needs</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="business-understanding.html"><a href="business-understanding.html#data-mining-goals"><i class="fa fa-check"></i><b>1.3</b> Data Mining Goals</a></li>
<li class="chapter" data-level="1.4" data-path="business-understanding.html"><a href="business-understanding.html#project-plan"><i class="fa fa-check"></i><b>1.4</b> Project Plan</a></li>
<li class="chapter" data-level="1.5" data-path="business-understanding.html"><a href="business-understanding.html#terms"><i class="fa fa-check"></i><b>1.5</b> Terms</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html"><i class="fa fa-check"></i><b>2</b> Data aquisition and understanding</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#description"><i class="fa fa-check"></i><b>2.1</b> Description</a></li>
<li class="chapter" data-level="2.2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#irrelevant-or-technical-information"><i class="fa fa-check"></i><b>2.2</b> Irrelevant or technical information</a></li>
<li class="chapter" data-level="2.3" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#target-variable-to-buy-or-not-to-buy"><i class="fa fa-check"></i><b>2.3</b> Target Variable: To buy or not to buy …</a></li>
<li class="chapter" data-level="2.4" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#customer-behavior-features"><i class="fa fa-check"></i><b>2.4</b> Customer Behavior Features</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#duration"><i class="fa fa-check"></i><b>2.4.1</b> Duration</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#page-view-quantity"><i class="fa fa-check"></i><b>2.4.2</b> Page View Quantity</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#product-pages-unique-page-views"><i class="fa fa-check"></i><b>2.4.3</b> Product Pages unique page views</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#designer-browsing-unique-page-views"><i class="fa fa-check"></i><b>2.4.4</b> Designer Browsing unique page views</a></li>
<li class="chapter" data-level="2.4.5" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#products-categories-unique-id"><i class="fa fa-check"></i><b>2.4.5</b> Products categories unique id</a></li>
<li class="chapter" data-level="2.4.6" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#potential-ideas-for-feature-engineering-which-were-not-implemented"><i class="fa fa-check"></i><b>2.4.6</b> Potential ideas for feature engineering which were not implemented</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#customer-journey-related-features"><i class="fa fa-check"></i><b>2.5</b> Customer Journey related Features</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#device-group"><i class="fa fa-check"></i><b>2.5.1</b> Device Group</a></li>
<li class="chapter" data-level="2.5.2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#platform"><i class="fa fa-check"></i><b>2.5.2</b> Platform</a></li>
<li class="chapter" data-level="2.5.3" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#journey-milestones"><i class="fa fa-check"></i><b>2.5.3</b> Journey milestones</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#client-segment-related-features"><i class="fa fa-check"></i><b>2.6</b> Client Segment related Features</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#customer-type"><i class="fa fa-check"></i><b>2.6.1</b> Customer type</a></li>
<li class="chapter" data-level="2.6.2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#segment"><i class="fa fa-check"></i><b>2.6.2</b> Segment</a></li>
<li class="chapter" data-level="2.6.3" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#visitor-type"><i class="fa fa-check"></i><b>2.6.3</b> Visitor type</a></li>
<li class="chapter" data-level="2.6.4" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#is-subscribed"><i class="fa fa-check"></i><b>2.6.4</b> Is subscribed</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#device-and-geography-related-features"><i class="fa fa-check"></i><b>2.7</b> Device and Geography related Features</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#browser-name"><i class="fa fa-check"></i><b>2.7.1</b> Browser name</a></li>
<li class="chapter" data-level="2.7.2" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#country"><i class="fa fa-check"></i><b>2.7.2</b> Country</a></li>
<li class="chapter" data-level="2.7.3" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#dealing-with-missing-data"><i class="fa fa-check"></i><b>2.7.3</b> Dealing with Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="data-aquisition-and-understanding.html"><a href="data-aquisition-and-understanding.html#summary-of-findings"><i class="fa fa-check"></i><b>2.8</b> Summary of findings</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-transformations.html"><a href="data-transformations.html"><i class="fa fa-check"></i><b>3</b> Data transformations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-transformations.html"><a href="data-transformations.html#summary-of-transformation-steps-identified-during-eda"><i class="fa fa-check"></i><b>3.1</b> Summary of transformation steps identified during EDA</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>4</b> Modeling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="modeling.html"><a href="modeling.html#baseline"><i class="fa fa-check"></i><b>4.1</b> Baseline</a></li>
<li class="chapter" data-level="4.2" data-path="modeling.html"><a href="modeling.html#naive-bayes-classifier"><i class="fa fa-check"></i><b>4.2</b> Naive Bayes Classifier</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="modeling.html"><a href="modeling.html#initial-experiments"><i class="fa fa-check"></i><b>4.2.1</b> Initial experiments</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="modeling.html"><a href="modeling.html#logistic-regression"><i class="fa fa-check"></i><b>4.3</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="modeling.html"><a href="modeling.html#initial-experiments-1"><i class="fa fa-check"></i><b>4.3.1</b> Initial experiments</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="modeling.html"><a href="modeling.html#knn"><i class="fa fa-check"></i><b>4.4</b> Knn</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="modeling.html"><a href="modeling.html#initial-experiment"><i class="fa fa-check"></i><b>4.4.1</b> Initial experiment</a></li>
<li class="chapter" data-level="4.4.2" data-path="modeling.html"><a href="modeling.html#fitting-multiple-models-using-grid-search"><i class="fa fa-check"></i><b>4.4.2</b> Fitting multiple models using grid search</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="modeling.html"><a href="modeling.html#workflow-rpart"><i class="fa fa-check"></i><b>4.5</b> Workflow: Rpart</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="modeling.html"><a href="modeling.html#initial-experiment-1"><i class="fa fa-check"></i><b>4.5.1</b> Initial experiment</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="modeling.html"><a href="modeling.html#workflow-random-forest"><i class="fa fa-check"></i><b>4.6</b> Workflow: Random Forest</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="modeling.html"><a href="modeling.html#initial-experiment-2"><i class="fa fa-check"></i><b>4.6.1</b> Initial experiment</a></li>
<li class="chapter" data-level="4.6.2" data-path="modeling.html"><a href="modeling.html#fitting-multiple-models-using-grid-search-1"><i class="fa fa-check"></i><b>4.6.2</b> Fitting multiple models using grid search</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="modeling.html"><a href="modeling.html#workflow-single-layer-neural-network"><i class="fa fa-check"></i><b>4.7</b> Workflow: Single Layer Neural Network</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="modeling.html"><a href="modeling.html#initial-experiment-3"><i class="fa fa-check"></i><b>4.7.1</b> Initial experiment</a></li>
<li class="chapter" data-level="4.7.2" data-path="modeling.html"><a href="modeling.html#fitting-multiple-models-using-grid-search-2"><i class="fa fa-check"></i><b>4.7.2</b> Fitting multiple models using grid search</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="modeling.html"><a href="modeling.html#support-vector-machine"><i class="fa fa-check"></i><b>4.8</b> Support Vector Machine</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="modeling.html"><a href="modeling.html#initial-experience-linear-kernel"><i class="fa fa-check"></i><b>4.8.1</b> Initial experience: Linear Kernel</a></li>
<li class="chapter" data-level="4.8.2" data-path="modeling.html"><a href="modeling.html#fitting-multiple-models"><i class="fa fa-check"></i><b>4.8.2</b> Fitting multiple models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="evaluation-and-conclusion.html"><a href="evaluation-and-conclusion.html"><i class="fa fa-check"></i><b>5</b> Evaluation and conclusion</a>
<ul>
<li class="chapter" data-level="5.1" data-path="evaluation-and-conclusion.html"><a href="evaluation-and-conclusion.html#next-steps."><i class="fa fa-check"></i><b>5.1</b> Next steps.</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Notebook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformations" class="section level1" number="3">
<h1><span class="header-section-number">Stage 3</span> Data transformations</h1>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="data-transformations.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># improt libraries</span></span>
<span id="cb62-2"><a href="data-transformations.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb62-3"><a href="data-transformations.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb62-4"><a href="data-transformations.html#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="data-transformations.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># import and prepare data</span></span>
<span id="cb62-6"><a href="data-transformations.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb62-7"><a href="data-transformations.html#cb62-7" aria-hidden="true" tabindex="-1"></a>unbalanced_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/train_full.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-8"><a href="data-transformations.html#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">1</span>, <span class="sc">-</span>session_id) <span class="sc">%&gt;%</span> </span>
<span id="cb62-9"><a href="data-transformations.html#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bought =</span> <span class="fu">as.factor</span>(bought))</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...1</code></pre>
<pre><code>## Rows: 95000 Columns: 21</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr  (9): session_id, plaform, segment, customer_type, device_group, visitor...
## dbl (12): ...1, has_listing, has_used_search, has_recommendation, has_add_to...</code></pre>
<pre><code>## 
## iÂ Use `spec()` to retrieve the full column specification for this data.
## iÂ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="data-transformations.html#cb67-1" aria-hidden="true" tabindex="-1"></a>balanced_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/train_balanced.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="data-transformations.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">1</span>, <span class="sc">-</span>session_id) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="data-transformations.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bought =</span> <span class="fu">as.factor</span>(bought))</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...1</code></pre>
<pre><code>## Rows: 16000 Columns: 21</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr  (9): session_id, plaform, segment, customer_type, device_group, visitor...
## dbl (12): ...1, has_listing, has_used_search, has_recommendation, has_add_to...</code></pre>
<pre><code>## 
## iÂ Use `spec()` to retrieve the full column specification for this data.
## iÂ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>The findings from the data exploration stage will be used to preprocess the data to be used for each model. Each model requires a set of specific transformation and each algorithm treats inputs differently (eg: Nearest Neigbors are sensible to scale, while naives bayes is not) so the pre process should be consider on a model experiment base.</p>
<p>Post-processing and model definition will be done on the next stage.</p>
<p>A number of key prepocess transformations are considered:
- feature selection and reducion. This is made using domain knowledge and looking at correlation between features. Nonetheless there is a test using full model. If not based on domain knowledge will use PCA transform.</p>
<ul>
<li><p>imputation of missing data when needed</p></li>
<li><p>Scale and center features when required by the model</p></li>
<li><p>Transform skwed features specially for models where variance plays a role or rely on gaussian (linear model). Given the business focus of interpreting the model (focus on inference) when possible will use log transform instead of more complex Box Plot transforms <span class="math inline">\(\lambda\)</span>.</p></li>
</ul>
<div id="summary-of-transformation-steps-identified-during-eda" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Summary of transformation steps identified during EDA</h2>
<p>The following transformations were identified during the EDA stage:</p>
<ul>
<li>Features <em>Device Group</em> and <em>Platform</em> showed a strong relationship between them. Given that <em>Platform</em> provides more information <em>Device Group will be removed</em></li>
<li>Features starting with <em>“has_”</em> refers to milestones on customer journey, therefore the need to include all of them should be taken in consideration. We will use PCA to merge this into one feature and experiment between the use of them individual or together,</li>
<li><em>Duration</em> feature is Right Skewed and contains observations which lack business sense. To avoid any impact on the model, specially on ones more sensible to variance, it will be log transformed and observations above 24hours will be removed</li>
<li>Replace all <em>Missing values</em> on <em>country</em>, <em>browser_name</em> and <em>is_subscribed</em> using Nearest Neighbors imputation with a very a k of 3,</li>
<li>Reduce the number of observations of class country and browser_name by compressing smaller ones into a generic class named others. This will be done because some models do not manage very well the fact that some dummy variables only have one level,</li>
<li>Reduce the number of levels of Segment by re factoring into a class of has or not segment,</li>
<li>Specially for the use of Neural Networks and Supervisor Vector Machines, numeric variables will be normalized and scaled</li>
<li>Converts <em>unique_browse_designer_qty, unique_product_qty, unique_browse_designer_qty, unique_browse_category_qty</em> to ratios over Total Pageviews (view_qty) which provides information on the amount of page views actually related to that category and subsequently log transform,</li>
<li>Sessions with duration lower than 2 seconds and a total page view of 0 or 1 will be removed</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="data-transformations.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For balanced data and to be used generically for all models</span></span>
<span id="cb72-2"><a href="data-transformations.html#cb72-2" aria-hidden="true" tabindex="-1"></a>preprocess <span class="ot">&lt;-</span> </span>
<span id="cb72-3"><a href="data-transformations.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(bought <span class="sc">~</span> . , <span class="at">data =</span> balanced_data) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="data-transformations.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_ratio</span>(<span class="fu">starts_with</span>(<span class="st">&quot;unique_&quot;</span>), <span class="at">denom =</span> <span class="fu">denom_vars</span>(view_qty)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="data-transformations.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(device_group, unique_product_qty, unique_browse_designer_qty, </span>
<span id="cb72-6"><a href="data-transformations.html#cb72-6" aria-hidden="true" tabindex="-1"></a>          unique_browse_category_qty) <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="data-transformations.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_other</span>(country, browser_name, <span class="at">threshold =</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="data-transformations.html#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_log</span>(view_qty) <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="data-transformations.html#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_filter</span>(</span>
<span id="cb72-10"><a href="data-transformations.html#cb72-10" aria-hidden="true" tabindex="-1"></a>    duration <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb72-11"><a href="data-transformations.html#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>((view_qty <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (duration <span class="sc">&lt;=</span> <span class="dv">2</span>))</span>
<span id="cb72-12"><a href="data-transformations.html#cb72-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="data-transformations.html#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">is_segment =</span> <span class="fu">ifelse</span>(segment <span class="sc">==</span> <span class="st">&quot;without_segment&quot;</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-14"><a href="data-transformations.html#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(segment) <span class="sc">%&gt;%</span> </span>
<span id="cb72-15"><a href="data-transformations.html#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_string2factor</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb72-16"><a href="data-transformations.html#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>(), <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-17"><a href="data-transformations.html#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">starts_with</span>(<span class="st">&quot;has_&quot;</span>), <span class="at">treshold =</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-18"><a href="data-transformations.html#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">threshold =</span> .<span class="dv">5</span>) </span>
<span id="cb72-19"><a href="data-transformations.html#cb72-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-20"><a href="data-transformations.html#cb72-20" aria-hidden="true" tabindex="-1"></a>preprocess_logit_nn <span class="ot">&lt;-</span> </span>
<span id="cb72-21"><a href="data-transformations.html#cb72-21" aria-hidden="true" tabindex="-1"></a>  preprocess <span class="sc">%&gt;%</span> </span>
<span id="cb72-22"><a href="data-transformations.html#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb72-23"><a href="data-transformations.html#cb72-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) </span>
<span id="cb72-24"><a href="data-transformations.html#cb72-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-25"><a href="data-transformations.html#cb72-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-26"><a href="data-transformations.html#cb72-26" aria-hidden="true" tabindex="-1"></a>preprocess_mlp_svm <span class="ot">&lt;-</span> </span>
<span id="cb72-27"><a href="data-transformations.html#cb72-27" aria-hidden="true" tabindex="-1"></a>  preprocess <span class="sc">%&gt;%</span> </span>
<span id="cb72-28"><a href="data-transformations.html#cb72-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb72-29"><a href="data-transformations.html#cb72-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb72-30"><a href="data-transformations.html#cb72-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb72-31"><a href="data-transformations.html#cb72-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-transformations.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(preprocess)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 6
##    number operation type          trained skip  id                 
##     &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;              
##  1      1 step      ratio         FALSE   FALSE ratio_KuUj3        
##  2      2 step      rm            FALSE   FALSE rm_HIp6r           
##  3      3 step      other         FALSE   FALSE other_9RvcY        
##  4      4 step      log           FALSE   FALSE log_tfGrx          
##  5      5 step      filter        FALSE   TRUE  filter_7bO7w       
##  6      6 step      mutate        FALSE   FALSE mutate_8qFw1       
##  7      7 step      rm            FALSE   FALSE rm_M0oH1           
##  8      8 step      string2factor FALSE   FALSE string2factor_UKyRw
##  9      9 step      impute_knn    FALSE   FALSE impute_knn_44PTL   
## 10     10 step      pca           FALSE   FALSE pca_Nt9Z9          
## 11     11 step      corr          FALSE   FALSE corr_uigwe</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="data-transformations.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(preprocess_logit_nn)</span></code></pre></div>
<pre><code>## # A tibble: 13 x 6
##    number operation type          trained skip  id                 
##     &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;              
##  1      1 step      ratio         FALSE   FALSE ratio_KuUj3        
##  2      2 step      rm            FALSE   FALSE rm_HIp6r           
##  3      3 step      other         FALSE   FALSE other_9RvcY        
##  4      4 step      log           FALSE   FALSE log_tfGrx          
##  5      5 step      filter        FALSE   TRUE  filter_7bO7w       
##  6      6 step      mutate        FALSE   FALSE mutate_8qFw1       
##  7      7 step      rm            FALSE   FALSE rm_M0oH1           
##  8      8 step      string2factor FALSE   FALSE string2factor_UKyRw
##  9      9 step      impute_knn    FALSE   FALSE impute_knn_44PTL   
## 10     10 step      pca           FALSE   FALSE pca_Nt9Z9          
## 11     11 step      corr          FALSE   FALSE corr_uigwe         
## 12     12 step      scale         FALSE   FALSE scale_27eL5        
## 13     13 step      dummy         FALSE   FALSE dummy_Daujr</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="data-transformations.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(preprocess_mlp_svm)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 6
##    number operation type          trained skip  id                 
##     &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;lgl&gt;   &lt;lgl&gt; &lt;chr&gt;              
##  1      1 step      ratio         FALSE   FALSE ratio_KuUj3        
##  2      2 step      rm            FALSE   FALSE rm_HIp6r           
##  3      3 step      other         FALSE   FALSE other_9RvcY        
##  4      4 step      log           FALSE   FALSE log_tfGrx          
##  5      5 step      filter        FALSE   TRUE  filter_7bO7w       
##  6      6 step      mutate        FALSE   FALSE mutate_8qFw1       
##  7      7 step      rm            FALSE   FALSE rm_M0oH1           
##  8      8 step      string2factor FALSE   FALSE string2factor_UKyRw
##  9      9 step      impute_knn    FALSE   FALSE impute_knn_44PTL   
## 10     10 step      pca           FALSE   FALSE pca_Nt9Z9          
## 11     11 step      corr          FALSE   FALSE corr_uigwe         
## 12     12 step      normalize     FALSE   FALSE normalize_GGAvn    
## 13     13 step      scale         FALSE   FALSE scale_rWpMt        
## 14     14 step      dummy         FALSE   FALSE dummy_tPOdH        
## 15     15 step      zv            FALSE   FALSE zv_fXtpm</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-transformations.html#cb79-1" aria-hidden="true" tabindex="-1"></a>preprocess_data <span class="ot">&lt;-</span>  <span class="fu">recipe</span>(bought <span class="sc">~</span> . , <span class="at">data =</span> balanced_data) <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="data-transformations.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_ratio</span>(<span class="fu">starts_with</span>(<span class="st">&quot;unique_&quot;</span>), <span class="at">denom =</span> <span class="fu">denom_vars</span>(view_qty)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="data-transformations.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(device_group, unique_product_qty, unique_browse_designer_qty, </span>
<span id="cb79-4"><a href="data-transformations.html#cb79-4" aria-hidden="true" tabindex="-1"></a>          unique_browse_category_qty) <span class="sc">%&gt;%</span> </span>
<span id="cb79-5"><a href="data-transformations.html#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_other</span>(country, browser_name, <span class="at">threshold =</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="data-transformations.html#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">is_bounce =</span> <span class="fu">ifelse</span>(view_qty <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="data-transformations.html#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_log</span>(view_qty) <span class="sc">%&gt;%</span></span>
<span id="cb79-8"><a href="data-transformations.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_filter</span>(duration <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb79-9"><a href="data-transformations.html#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>((view_qty <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (duration <span class="sc">&lt;=</span> <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb79-10"><a href="data-transformations.html#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">is_segment =</span> <span class="fu">ifelse</span>(segment <span class="sc">==</span> <span class="st">&quot;without_segment&quot;</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-11"><a href="data-transformations.html#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(segment) <span class="sc">%&gt;%</span> </span>
<span id="cb79-12"><a href="data-transformations.html#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_string2factor</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb79-13"><a href="data-transformations.html#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_predictors</span>(), <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-14"><a href="data-transformations.html#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">starts_with</span>(<span class="st">&quot;has_&quot;</span>), <span class="at">num_comp =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-15"><a href="data-transformations.html#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">threshold =</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-16"><a href="data-transformations.html#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb79-17"><a href="data-transformations.html#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb79-18"><a href="data-transformations.html#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb79-19"><a href="data-transformations.html#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb79-20"><a href="data-transformations.html#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-21"><a href="data-transformations.html#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) </span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="data-transformations.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(preprocess_data)</span></code></pre></div>
<pre><code>##     duration       bought   unique_product_qty_o_view_qty   is_bounce       
##  Min.   :-0.7436   0:4087   Min.   :-0.9715               Min.   :-0.03526  
##  1st Qu.:-0.6329   1:7991   1st Qu.:-0.6674               1st Qu.:-0.03526  
##  Median :-0.3610            Median :-0.2637               Median :-0.03526  
##  Mean   : 0.0000            Mean   : 0.0000               Mean   : 0.00000  
##  3rd Qu.: 0.2597            3rd Qu.: 0.3341               3rd Qu.:-0.03526  
##  Max.   :11.7405            Max.   : 3.8947               Max.   :28.35725  
##    is_segment           PC1          plaform_website  customer_type_prospect
##  Min.   :-0.9183   Min.   :-1.5186   Min.   :0.0000   Min.   :0.0000        
##  1st Qu.:-0.9183   1st Qu.:-0.7680   1st Qu.:0.0000   1st Qu.:0.0000        
##  Median :-0.9183   Median :-0.0134   Median :0.0000   Median :0.0000        
##  Mean   : 0.0000   Mean   : 0.0000   Mean   :0.4945   Mean   :0.4822        
##  3rd Qu.: 1.0888   3rd Qu.: 0.7120   3rd Qu.:1.0000   3rd Qu.:1.0000        
##  Max.   : 1.0888   Max.   : 1.6572   Max.   :1.0000   Max.   :1.0000        
##  visitor_type_returning is_subscribed_Unknown is_subscribed_Yes
##  Min.   :0.0000         Min.   :0.00000       Min.   :0.0000   
##  1st Qu.:1.0000         1st Qu.:0.00000       1st Qu.:0.0000   
##  Median :1.0000         Median :0.00000       Median :1.0000   
##  Mean   :0.7606         Mean   :0.00149       Mean   :0.6239   
##  3rd Qu.:1.0000         3rd Qu.:0.00000       3rd Qu.:1.0000   
##  Max.   :1.0000         Max.   :1.00000       Max.   :1.0000   
##  browser_name_Safari browser_name_other   country_RU       country_US    
##  Min.   :0.0000      Min.   :0.0000     Min.   :0.0000   Min.   :0.0000  
##  1st Qu.:0.0000      1st Qu.:0.0000     1st Qu.:0.0000   1st Qu.:0.0000  
##  Median :0.0000      Median :0.0000     Median :0.0000   Median :0.0000  
##  Mean   :0.4369      Mean   :0.2013     Mean   :0.1177   Mean   :0.2166  
##  3rd Qu.:1.0000      3rd Qu.:0.0000     3rd Qu.:0.0000   3rd Qu.:0.0000  
##  Max.   :1.0000      Max.   :1.0000     Max.   :1.0000   Max.   :1.0000  
##  country_other   
##  Min.   :0.0000  
##  1st Qu.:0.0000  
##  Median :1.0000  
##  Mean   :0.6018  
##  3rd Qu.:1.0000  
##  Max.   :1.0000</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-aquisition-and-understanding.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-data_transformations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
